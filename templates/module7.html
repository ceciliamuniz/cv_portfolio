{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>Module 7: Object Size Estimation (Stereo)</h2>
  <form id="stereo-form" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="left" class="form-label">Left Image</label>
      <input type="file" class="form-control" id="left" name="left" accept="image/*" required>
    </div>
    <div class="mb-3">
      <label for="right" class="form-label">Right Image</label>
      <input type="file" class="form-control" id="right" name="right" accept="image/*" required>
    </div>
    <div class="mb-3">
      <label for="mask" class="form-label">Object Mask (binary)</label>
      <input type="file" class="form-control" id="mask" name="mask" accept="image/*" required>
    </div>
    <button type="submit" class="btn btn-primary">Estimate Size</button>
  </form>
  <div id="result" class="mt-4"></div>
</div>
{% endblock %}
{% block scripts %}
<script>
document.getElementById('stereo-form').onsubmit = async function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const res = await fetch('/api/stereo/estimate', {
    method: 'POST',
    body: formData
  });
  const data = await res.json();
  let html = '';
  if (data.results) {
    data.results.forEach(obj => {
      html += `<div><b>Shape:</b> ${obj.shape}<br>`;
      for (const [k, v] of Object.entries(obj.dimensions)) {
        if (Array.isArray(v)) {
          html += `<b>${k}:</b> ${v.map(x => x.toFixed(2)).join(', ')} m<br>`;
        } else {
          html += `<b>${k}:</b> ${v.toFixed(2)} m<br>`;
        }
      }
      html += '</div><hr>';
    });
  } else {
    html = `<div class="text-danger">${data.error}</div>`;
  }
  document.getElementById('result').innerHTML = html;
};
</script>
{% endblock %}
